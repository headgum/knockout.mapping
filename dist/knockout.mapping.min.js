!function(e){"use strict";if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module)e(require("@tko/build.reference/dist/build.reference.es6"),exports);else if("function"==typeof define&&define.amd)define(["tko","exports"],e);else{if("undefined"==typeof ko)throw new Error("Knockout is required, please ensure it is loaded before loading this mapping plug-in");e(ko,ko.mapping={})}}(function(q,F){"use strict";q.mapping=F;var R,$,s=!1,G="__ko_mapping__",p=q.dependentObservable,i=0,o=["create","update","key","arrayChanged"],K={},e={include:["_destroy"],ignore:[],copy:[],observe:[]},u=e;function l(){for(var e,r,t,n=arguments,a=n.length,i={},o=[];a--;)for(e=(t=n[a]).length;e--;)i[r=t[e]]||(i[r]=1,o.push(r));return o}function f(e,r){var t;for(var n in r)if(r.hasOwnProperty(n)&&r[n])if(t=F.getType(e[n]),n&&e[n]&&"array"!==t&&"string"!==t)f(e[n],r[n]);else{var a="array"===F.getType(e[n])&&"array"===F.getType(r[n]);e[n]=a?l(e[n],r[n]):r[n]}}function V(e,r){var t={};return f(t,e),f(t,r),t}function y(e,r){for(var t=V({},e),n=o.length-1;0<=n;n--){var a=o[n];t[a]&&(t[""]instanceof Object||(t[""]={}),t[""][a]=t[a],delete t[a])}return r&&(t.ignore=v(r.ignore,t.ignore),t.include=v(r.include,t.include),t.copy=v(r.copy,t.copy),t.observe=v(r.observe,t.observe)),t.ignore=v(t.ignore,u.ignore),t.include=v(t.include,u.include),t.copy=v(t.copy,u.copy),t.observe=v(t.observe,u.observe),t.mappedProperties=t.mappedProperties||{},t.copiedProperties=t.copiedProperties||{},t}function v(e,r){return void 0===e?e=[]:"array"!==F.getType(e)&&(e=[e]),void 0===r?r=[]:"array"!==F.getType(r)&&(r=[r]),q.utils.arrayGetDistinctValues(e.concat(r))}function z(u,e){var r=q.dependentObservable;q.dependentObservable=function(e,r,t){t=t||{},e&&"object"==typeof e&&(t=e);var n=t.deferEvaluation,a=t.pure,i=!1;t.deferEvaluation=!0;var o=p(e,r,t);return n||a||(o=function(r){var e=q.dependentObservable;q.dependentObservable=p;var t=q.isWriteableObservable(r);q.dependentObservable=e;var n=p({read:function(){return i||(q.utils.arrayRemoveItem(u,r),i=!0),r.apply(r,arguments)},write:t&&function(e){return r(e)},deferEvaluation:!0});return s&&(n._wrapper=!0),n.__DO=r,n}(o),u.push(o)),o},q.dependentObservable.fn=p.fn,q.computed=q.dependentObservable;var t=e();return q.dependentObservable=r,q.computed=q.dependentObservable,t}function B(e,r,t){for(var n=0,a=e.length;n<a;n++)if(!0!==t[n]&&e[n]===r)return n;return null}function c(e,r){var t;return r&&(t=r(e)),"undefined"===F.getType(t)&&(t=e),q.utils.unwrapObservable(t)}function H(e,r,t){for(var n=0,a=(e=q.utils.unwrapObservable(e)).length;n<a;n++){var i=e[n];if(c(i,t)===r)return i}throw new Error("When calling ko.update*, the key '"+r+"' was not found!")}function L(e,r){return q.utils.arrayMap(q.utils.unwrapObservable(e),function(e){return r?c(e,r):e})}function Q(e,r){if("array"===F.getType(e))for(var t=0;t<e.length;t++)r(t);else for(var n in e)e.hasOwnProperty(n)&&r(n)}function U(e){if(null===e)return!1;var r=F.getType(e);return"object"===r||"array"===r}function X(e){return(""+e).replace(/~/g,"~~").replace(/\[/g,"~[").replace(/]/g,"~]").replace(/\./g,"~.")}function a(){var n=[],a=[];this.save=function(e,r){var t=q.utils.arrayIndexOf(n,e);0<=t?a[t]=r:(n.push(e),a.push(r))},this.get=function(e){var r=q.utils.arrayIndexOf(n,e);return 0<=r?a[r]:void 0}}function g(){var n={},t=function(e){var r;try{r=e}catch(e){r="$$$"}var t=n[r];return n.hasOwnProperty(r)||(t=new a,n[r]=t),t};this.save=function(e,r){t(e).save(e,r)},this.get=function(e){return t(e).get(e)}}F.isMapped=function(e){var r=q.utils.unwrapObservable(e);return r&&r[G]},F.fromJS=function(e){if(0===arguments.length)throw new Error("When calling ko.fromJS, pass the object you want to convert.");try{var r,t;i||(R=[],$=new g),i++,2===arguments.length&&(arguments[1][G]?t=arguments[1]:r=arguments[1]),3===arguments.length&&(r=arguments[1],t=arguments[2]),t&&(r=V(r,t[G]));var n=function i(o,u,s,n,r,p,e){var t="array"===F.getType(q.utils.unwrapObservable(u));p=p||"";if(F.isMapped(o)){var a=q.utils.unwrapObservable(o)[G];s=V(a,s)}var l={data:u,parent:e||r};var f=function(){return s[n]&&s[n].create instanceof Function};var v=function(e){return z(R,function(){return q.utils.unwrapObservable(r)instanceof Array?s[n].create({data:e||l.data,parent:l.parent,skip:K}):s[n].create({data:e||l.data,parent:l.parent})})};var c=function(){return s[n]&&s[n].update instanceof Function};var d=function(e,r){var t={data:r||l.data,parent:l.parent,target:q.utils.unwrapObservable(e)};return q.isWriteableObservable(e)&&(t.observable=e),s[n].update(t)};var b=$.get(u);if(b)return b;n=n||"";if(t){var y=[],g=!1,O=function(e){return e};s[n]&&s[n].key&&(O=s[n].key,g=!0),q.isObservable(o)||((o=q.observableArray([])).mappedRemove=function(r){var t="function"==typeof r?r:function(e){return e===O(r)};return o.remove(function(e){return t(O(e))})},o.mappedRemoveAll=function(e){var r=L(e,O);return o.remove(function(e){return-1!==q.utils.arrayIndexOf(r,O(e))})},o.mappedDestroy=function(r){var t="function"==typeof r?r:function(e){return e===O(r)};return o.destroy(function(e){return t(O(e))})},o.mappedDestroyAll=function(e){var r=L(e,O);return o.destroy(function(e){return-1!==q.utils.arrayIndexOf(r,O(e))})},o.mappedIndexOf=function(e){var r=L(o(),O),t=O(e);return q.utils.arrayIndexOf(r,t)},o.mappedGet=function(e){return o()[o.mappedIndexOf(e)]},o.mappedCreate=function(e){if(-1!==o.mappedIndexOf(e))throw new Error("There already is an object with the key that you specified.");var r=f()?v(e):e;if(c()){var t=d(r,e);q.isWriteableObservable(r)?r(t):r=t}return o.push(r),r});var h=L(q.utils.unwrapObservable(o),O).sort(),w=L(u,O);g&&w.sort();var m,k,T,x=q.utils.compareArrays(h,w),j={},I=q.utils.unwrapObservable(u),E={},P=!0;for(m=0,k=I.length;m<k;m++){if(void 0===(T=O(I[m]))||T instanceof Object){P=!1;break}E[T]=I[m]}var _,J,W=[],D=0;for(m=0,k=x.length;m<k;m++){var S;T=x[m];var A=p+"["+X(m)+"]";switch(T.status){case"added":_=P?E[T.value]:H(q.utils.unwrapObservable(u),T.value,O),S=i(void 0,_,s,n,o,A,r),f()||(S=q.utils.unwrapObservable(S)),J=B(q.utils.unwrapObservable(u),_,j),S===K?D++:W[J-D]=S,j[J]=!0;break;case"retained":_=P?E[T.value]:H(q.utils.unwrapObservable(u),T.value,O),S=H(o,T.value,O),i(S,_,s,n,o,A,r),J=B(q.utils.unwrapObservable(u),_,j),W[J]=S,j[J]=!0;break;case"deleted":S=H(o,T.value,O)}y.push({event:T.status,item:S})}o(W),s[n]&&s[n].arrayChanged&&q.utils.arrayForEach(y,function(e){s[n].arrayChanged(e.event,e.item)})}else if(U(u)){if(!(o=q.utils.unwrapObservable(o))){if(f()){var N=v();return c()&&(N=d(N)),N}if(c())return d();o={}}if(c()&&(o=d(o)),$.save(u,o),c())return o;Q(u,function(e){var r=p.length?p+"."+X(e):X(e);if(-1===q.utils.arrayIndexOf(s.ignore,r))if(-1===q.utils.arrayIndexOf(s.copy,r)){if("object"!=typeof u[e]&&"array"!==F.getType(u[e])&&0<s.observe.length&&-1===q.utils.arrayIndexOf(s.observe,r))return o[e]=u[e],void(s.copiedProperties[r]=!0);var t=$.get(u[e]),n=i(o[e],u[e],s,e,o,r,o),a=t||n;if(0<s.observe.length&&-1===q.utils.arrayIndexOf(s.observe,r))return o[e]=q.utils.unwrapObservable(a),void(s.copiedProperties[r]=!0);q.isWriteableObservable(o[e])?(a=q.utils.unwrapObservable(a),o[e]()!==a&&o[e](a)):(a=void 0===o[e]?a:q.utils.unwrapObservable(a),o[e]=a),s.mappedProperties[r]=!0}else o[e]=u[e]})}else switch(F.getType(u)){case"function":o=c()?q.isWriteableObservable(u)?(u(d(u)),u):d(u):u;break;default:var M;if(q.isWriteableObservable(o))return M=c()?d(o):q.utils.unwrapObservable(u),o(M),M;var C=f()||c();if(o=f()?v():q.observable(q.utils.unwrapObservable(u)),c()&&o(d(o)),C)return o}return o}(t,e,r=y(r));if(t&&(n=t),!--i)for(;R.length;){var a=R.pop();a&&(a(),a.__DO.throttleEvaluation=a.throttleEvaluation)}return n[G]=V(n[G],r),n}catch(e){throw i=0,e}},F.fromJSON=function(e){var r=Array.prototype.slice.call(arguments,0);return r[0]=q.utils.parseJson(e),F.fromJS.apply(this,r)},F.toJS=function(e,r){if(u||F.resetDefaultOptions(),0===arguments.length)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==F.getType(u.ignore))throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==F.getType(u.include))throw new Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==F.getType(u.copy))throw new Error("ko.mapping.defaultOptions().copy should be an array.");return r=y(r,e[G]),F.visitModel(e,function(e){return q.utils.unwrapObservable(e)},r)},F.toJSON=function(e,r,t,n){var a=F.toJS(e,r);return q.utils.stringifyJson(a,t,n)},F.defaultOptions=function(){if(!(0<arguments.length))return u;u=arguments[0]},F.resetDefaultOptions=function(){u={include:e.include.slice(0),ignore:e.ignore.slice(0),copy:e.copy.slice(0),observe:e.observe.slice(0)}},F.getType=function(e){if(e&&"object"==typeof e){if(e.constructor===Date)return"date";if(e.constructor===Array)return"array"}return typeof e},F.visitModel=function(e,f,v){var c;(v=v||{}).visitedObjects=v.visitedObjects||new g;var d=q.utils.unwrapObservable(e);if(!U(d))return f(e,v.parentName);v=y(v,d[G]),f(e,v.parentName),c="array"===F.getType(d)?[]:{},v.visitedObjects.save(e,c);var b=v.parentName;return Q(d,function(e){var r=X(e);if(!v.ignore||-1===q.utils.arrayIndexOf(v.ignore,r)){var t,n,a,i,o=d[e];if(v.parentName=(n=d,a=e,i=(t=b)||"","array"===F.getType(n)?t&&(i+="["+X(a)+"]"):(t&&(i+="."),i+=X(a)),i),-1===q.utils.arrayIndexOf(v.copy,r)&&-1===q.utils.arrayIndexOf(v.include,r)){var u=d[G];if(u){var s=u.mappedProperties;if(s&&!s[r]){var p=u.copiedProperties;if(p&&!p[r]&&"array"!==F.getType(d))return}}}switch(F.getType(q.utils.unwrapObservable(o))){case"object":case"array":case"undefined":var l=v.visitedObjects.get(o);c[e]="undefined"!==F.getType(l)?l:F.visitModel(o,f,v);break;default:c[e]=f(o,v.parentName)}}}),c}});
//# sourceMappingURL=knockout.mapping.min.js.map
